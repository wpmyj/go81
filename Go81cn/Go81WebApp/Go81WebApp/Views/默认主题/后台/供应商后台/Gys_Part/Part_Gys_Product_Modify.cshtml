@using Go81WebApp.Models.数据模型
@using Go81WebApp.Models.数据模型.商品数据模型
@model Go81WebApp.Models.数据模型.商品数据模型.商品
<script type="text/javascript" src="~/JS/Get_productClass.js"></script>
<link rel="stylesheet" href="~/css/index.css" type="text/css">
<link href="~/css/Msg_Tips.css" rel="stylesheet" />
<link rel="stylesheet" href="~/JS/kindeditor-4.1.10/themes/default/default.css" />
<link rel="stylesheet" href="~/JS/kindeditor-4.1.10/plugins/code/prettify.css" />
<script charset="utf-8" src="~/JS/kindeditor-4.1.10/kindeditor.js"></script>
<script charset="utf-8" src="~/JS/kindeditor-4.1.10/lang/zh_CN.js"></script>
<script charset="utf-8" src="~/JS/kindeditor-4.1.10/plugins/code/prettify.js"></script>

<link type="text/css" rel="stylesheet" href="~/JS/jquery.uploadify-v2.1.4/uploadify.css" />
<script type="text/javascript" language="javascript" src="~/JS/jquery.uploadify-v2.1.4/jquery.uploadify.v2.1.4.js" charset="gb2312"></script>
<script type="text/javascript" language="javascript" src="~/JS/jquery.uploadify-v2.1.4/swfobject.js" charset="gb2312"></script>
<script src="~/JS/provinceandcity_all.js"></script>
<script>
    var editor1;
    KindEditor.ready(function (K) {
        editor1 = K.create('#content1', {
            cssPath: '../JS/kindeditor-4.1.10/plugins/code/prettify.css',
            uploadJson: '../JS/kindeditor-4.1.10/asp.net/upload_json.ashx',
            fileManagerJson: '../JS/kindeditor-4.1.10/asp.net/file_manager_json.ashx',
            allowFileManager: true,
            resizeType:0,
        });
    });

    //售后服务的编辑器
    var editor2;
    KindEditor.ready(function (K) {
        editor2 = K.create('#content2', {
            cssPath: '../JS/kindeditor-4.1.10/plugins/code/prettify.css',
            uploadJson: '../JS/kindeditor-4.1.10/asp.net/upload_json.ashx',
            fileManagerJson: '../JS/kindeditor-4.1.10/asp.net/file_manager_json.ashx',
            allowFileManager: true,
            resizeType: 0,
        });
    });
</script>
<script type="text/javascript">
    function nextStep(num,num1) {
        //价格验证正则表达式
        var pricerg = /^(:?(:?\d+.\d+)|(:?\d+))$/;
        if (num == 1) {

            //验证项目编号
            if ($("#proliststr").length >= 1) {
                var pronamelist = $("#proliststr").val().substring(0, $("#proliststr").val().length - 1).split('|');
                for (var proindex = 0; proindex < pronamelist.length; proindex++) {
                    if ($.trim($("#pronum___" + pronamelist[proindex]).val()) == "") {
                        $("#pronum___" + pronamelist[proindex]).focus();
                        //$("#p_number___" + pronamelist[proindex]).show();
                        alert("请填写项目编号");
                        return false;
                    }
                    if ($.trim($("#procount___" + pronamelist[proindex]).val()) == "") {
                        $("#procount___" + pronamelist[proindex]).focus();
                        //$("#p_number___" + pronamelist[proindex]).show();
                        alert("请填写中标数量");
                        return false;
                    }
                    if ($.trim($("#proprice___" + pronamelist[proindex]).val()) == "") {
                        $("#proprice___" + pronamelist[proindex]).focus();
                        //$("#p_number___" + pronamelist[proindex]).show();
                        alert("请填写中标金额");
                        return false;
                    }
                }
            }

            //验证商品名称
            var stepcheckparm = $('input[name="商品信息.商品名"]');
            if ($.trim(stepcheckparm.val()) == "") {
                $("#p_name").show();
                $(stepcheckparm).focus();
                return false;
            } else {
                //$("#Uppicture").css({ "display": "inline", "height": "20px" });
                //$("#product_tabmenu_content").css({ "height": "auto" });
                $("#p_name").hide();
            }
            var procount = @Model.中标信息.Count;
            //验证中标数量
            stepcheckparm = $('input[name="中标商品数量"]');
            if ($.trim(stepcheckparm.val()) == "") {
                $("#p_bidnumber").show();
                $(stepcheckparm).focus();
                //return false;
            }
            else {
                $("#p_bidnumber").hide();
            }
            //验证中标金额
            stepcheckparm = $('input[name="中标金额"]');
            if ($.trim(stepcheckparm.val()) == "") {
                $("#p_bidaccount").show();
                $(stepcheckparm).focus();
                //return false;
            }
            else {
                $("#p_bidaccount").hide();
            }

            //验证商品型号
            stepcheckparm = $('input[name="商品信息.型号"]');
            if ($.trim(stepcheckparm.val()) == "") {
                $("#p_xinghao").show();
                $(stepcheckparm).focus();
                return false;
            }
            else {
                $("#p_xinghao").hide();
            }

            //验证商品计量单位
            stepcheckparm = $('input[name="商品信息.计量单位"]');
            if ($.trim(stepcheckparm.val()) == "") {
                $("#p_jldw").show();
                $(stepcheckparm).focus();
                return false;
            }
            else {
                $("#p_jldw").hide();
            }

            //验证商品价格
            stepcheckparm = $('input[name="销售信息.价格"]');
            if ($.trim(stepcheckparm.val()) == "" || !(stepcheckparm.val().match(pricerg)) || stepcheckparm.val() == 0) {
                $("#p_price").show();
                $(stepcheckparm).focus();
                return false;
            }
            else {
                //$("#Uppicture").css({ "display": "inline", "height": "20px" });
                //$("#product_tabmenu_content").css({ "height": "auto" });
                $("#p_price").hide();
            }

            //验证商品简介
            stepcheckparm = $('textarea[name="商品数据.商品简介"]');
            if ($.trim(stepcheckparm.val()) == "") {
                $("#p_des").show();
                $(stepcheckparm).focus();
                return false;
            } else {
                //$("#Uppicture").css({ "display": "inline", "height": "20px" });
                //$("#product_tabmenu_content").css({ "height": "auto" });
                $("#p_des").hide();
            }

            //验证商品详情
            editor1.sync("content1");
            stepcheckparm = $("#content1");
            if ($.trim(stepcheckparm.val()) == "") {
                $("#p_detaildes").show();
                $(stepcheckparm).focus();
                return false;
            } else {
                //$("#Uppicture").css({ "display": "inline", "height": "20px" });
                //$("#product_tabmenu_content").css({ "height": "auto" });
                $("#p_detaildes").hide();
            }
        }

        //验证价格组合处的价格格式
        if (num == 2) {
            var trcontent = document.getElementsByName("table_tr");//价格匹配表格内容td
            if (trcontent.length > 0) {
                var tdcont = trcontent[0].childNodes.length;

                //trcontent.length==>价格匹配总行数
                for (var i = 0; i < trcontent.length; i++) {
                    var tdcontent = trcontent[i].childNodes;

                    if (!((tdcontent[tdcont - 1].getElementsByTagName("input")[0].value).match(pricerg)) || tdcontent[tdcont - 1].getElementsByTagName("input")[0].value == 0) {
                        $("#priceerrormessage").html("价格填写有误!");
                        tdcontent[tdcont - 1].getElementsByTagName("input")[0].focus();
                        return false;
                    }
                    else {
                        $("#priceerrormessage").html("");
                    }
                }
            }
        }
        $("div#listdiv ul li").each(function () {
            $(this).removeClass("cli");
        });
        $("div#listdiv ul li:eq(" + num + ")").addClass("cli");
        $("div#product_tabmenu_content ul").each(function () {
            $(this).hide();
        });
        $("div#product_tabmenu_content ul:eq(" + num1 + ")").show();
    }
    function preStep(num,num1) {
        $("div#listdiv ul li").each(function () {
            $(this).removeClass("cli");
        });
        $("div#listdiv ul li:eq(" + num + ")").addClass("cli");
        $("div#product_tabmenu_content ul").each(function () {
            $(this).hide();
        });
        $("div#product_tabmenu_content ul:eq(" + num1 + ")").show();
    }
</script>
<div id="f1" class="modal_out">
    <div class="modal_in"></div>
    <div class="modal_content_loading">
        <img src="~/Images/ajax-loader.gif" />
        <span>正在上传，请稍等...</span>
    </div>
</div>
@{
    long id = long.Parse(ViewData["userId"].ToString());
}
@if (Model.中标商品)
{
    <div id="pro_numdiv" style="display: none;">
        <div class="product_add_textarabox">
            <div style="float:left;padding-right:5px;">
                <div class="product_add_toptitle">项目编号：</div>
                <input type="text" id="pronum___a" name="pronum___a" style="width: 130px;" />
                <span style="float: left;">*</span>
                <span id="p_number___a" style="display: none; float: left;">请输入项目编号</span>
            </div>
            <div style="float:left;padding-right:5px;">
                <div class="product_add_toptitle">中标数量：</div>
                <input type="text" id="procount___a" name="procount___a" style="width: 130px;" />
                <span style="float: left;">*</span>
                <span id="p_count___a" style="display: none;">请输入中标商品数量</span>
            </div>
            <div style="float:left;padding-right:5px;">
                <div class="product_add_toptitle">中标金额：</div>
                <input type="text" id="proprice___a" name="proprice___a" style="width: 130px;" />
                <span style="float: left;">*</span>
                <span id="p_price___a" style="display: none;">请输入中标金额</span>
                <input type="button" style="width: 100px; float: left; height: 35px;" value="删除该项目" id="deleteprobtn___a" onclick="deletepro(this)" />
            </div>
        </div>
    </div>
    <script>
        var procount = @Model.中标信息.Count;
        function deletepro(obj) {
            var id = $(obj).attr("id").replace("deleteprobtn___", "");
            $(obj).parent().parent().remove();
            $("#proliststr").val($("#proliststr").val().replace(id + "|", ""));
        }
        function addpro(obj) {
            var html = $("#pro_numdiv").html().replace(/___a/g, "___" + procount);
            $("#proneedproname").before(html);
            $("#proliststr").val($("#proliststr").val() + procount + "|");
            procount++;
        }
    </script>
}


<div class="product_add_tabmenu_box">
    <div class="title-base-out">
        <div class="title-base-middle">
            <div class="title-base-inner" style="float:left">商品信息</div>
            <div class="product_tabmenu_tabmenu" id="listdiv">
                <ul>
                    <li onclick="change_tbl(this,1)" class="cli">商品描述</li>
                    <li onclick="change_tbl(this,0)">商品图片</li>
                    <li onclick="change_tbl(this,2)">商品属性</li>
                    <li onclick="change_tbl(this,3)">售后服务</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="product_tabmenu_content_box" id="product_tabmenu_content">
        <ul>
            <li>
                <div>
                    <div class="product_add_toptitle" style="width: 800px; float:left; height:auto; text-align: left;">
                        <table>
                            <tr>
                                <td>商品图片：</td>
                                <td>
                                    <a style="color:red;" onclick="javascript: $('#file').show(); $(this).hide();">【点击此处添加图片】</a>
                                    <div id="Uppicture" style="width:9s0%; display:inline;">
                                        <form action="/供应商后台/UploadImages" method="post" name="upload" enctype="multipart/form-data" target="showPic">
                                            <input type="hidden" value="showPic" name="pic1" />
                                            <table width="100%" style="font-size:14px; margin-left:30px;">
                                                <tr>
                                                    <td>
                                                        <span id="file" style="display:none;">
                                                            <input type="file" style="width:70px;" accept="image/jpeg" onchange="filechange(0)" multiple="multiple" name="file1" size="40" />
                                                            (点击添加图片<em style="color:red;">注：请上传5M以下的jpg格式图片)</em>
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                        </form>
                                        <div id="framebox" style="display:none;margin-left:20px; margin-top:10px;width:700px;  margin-right: auto;">
                                            <iframe name="showPic" id="showPic" frameborder="0" height="150" width="100%"></iframe>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    @if (Model.商品信息.商品图片 != null && Model.商品信息.商品图片.Count > 0)
                    {

                        <div style="padding:5px;">
                            @for (int i = 0; i < Model.商品信息.商品图片.Count(); i++)
                            {
                                <div id="uploadifyIHPVEG" class="uploadifyQueueItem completed" style="text-align: center; margin-bottom: 10px;">
                                    <img width="120" height="70" src="@Model.商品信息.商品图片[i]">
                                    <div style="margin-top:5px;text-align:center">
                                        <a href="@Model.商品信息.商品图片[i]" target="_blank">预览</a>
                                        &nbsp;&nbsp;<a href="@Model.商品信息.商品图片[i]" target="_blank">原图</a>
                                        &nbsp;&nbsp;<a title="@Model.商品信息.商品图片[i]" lang="@i" id="@Model.Id" style="cursor:pointer;" onclick="deleteattach(this,0)">删除</a>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    <div id="pBox" style="width:80%; margin-right:auto; margin-left:auto; height:auto; margin-top:20px;">

                    </div>
                </div>

                <div class="product_add_toptitle" style="width: 800px; height:auto; text-align: left;">
                    <table width="100%">
                        <tr>
                            <td width="15%" align="left">商品型号图片：</td>
                            <td align="left">
                                <a style="color:red;" onclick="javascript: $('#file1').show(); $(this).hide();">【点击此处添加图片】</a>
                                <div id="Uppicture1" style="width:90%;">
                                    <form action="/供应商后台/UploadImages" method="post" name="upload1" enctype="multipart/form-data" target="showPic">
                                        <input type="hidden" value="gtype" name="pic1" />
                                        <table width="100%" style="font-size:14px; margin-left:30px;">
                                            <tr>
                                                <td>
                                                    <span id="file1" style="display:none;">
                                                        <input type="file" style="width:70px;" accept="image/jpeg" onchange="filechange(1)" multiple="multiple" name="file1" size="40" />
                                                        (点击添加图片<em style="color:red;">注：请上传5M以下的jpg格式图片)</em>
                                                    </span>
                                                </td>
                                            </tr>
                                        </table>
                                    </form>
                                    <div id="framebox" style="display:none;margin-left:20px; margin-top:10px;width:700px;  margin-right: auto;">
                                        <iframe name="showPic" id="showPic" frameborder="0" height="150" width="100%"></iframe>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                    @if (Model.商品信息.商品型号图片 != null && Model.商品信息.商品型号图片.Any())
                    {
                        <div style="padding:5px;">
                            @for (int i = 0; i < Model.商品信息.商品型号图片.Count(); i++)
                            {
                                <div id="uploadifyIHPVEG" class="uploadifyQueueItem completed" style="text-align: center; margin-bottom: 10px;">
                                    <img width="120" height="70" src="@Model.商品信息.商品型号图片[i]">
                                    <div style="margin-top:5px;text-align:center">
                                        <a href="@Model.商品信息.商品型号图片[i]" target="_blank">预览</a>
                                        &nbsp;&nbsp;<a href="@Model.商品信息.商品型号图片[i]" target="_blank">原图</a>
                                        &nbsp;&nbsp;<a title="@Model.商品信息.商品型号图片[i]" lang="@i" id="@Model.Id" style="cursor:pointer;" onclick="deleteattach(this,1)">删除</a>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    <div id="pBox1" style="width:80%; margin-right:auto; margin-left:auto; height:auto; margin-top:20px;">

                    </div>
                </div>

                <div style="width: 300px; float: right;padding:20px 0 20px 0;">
                    <input type="button" value="上一步" class="index_online_btn" onclick="preStep(0,1)">
                    <input type="button" value="下一步" class="index_online_btn" onclick="return nextStep(2,2)">
                </div>
            </li>
        </ul>
        @using (Html.BeginForm("Gys_Product_Modify", "供应商后台"))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true)
            <ul class="fdiv">
                <li>
                    <div class="product_add_textarabox">
                        <div class="product_add_toptitle">所属分类：</div>
                        @if (Model.商品信息.所属商品分类.商品分类.分类性质 == 商品分类性质.专用物资)
                        {
                            <span style="color:black;font-size:13px;">
                                : @Model.商品信息.所属商品分类.商品分类.父分类.商品分类.分类名 > @Model.商品信息.所属商品分类.商品分类.分类名
                            </span>
                        }
                        else
                        {
                            <span style="color:black;font-size:13px;">
                                : @Model.商品信息.所属商品分类.商品分类.父分类.商品分类.父分类.商品分类.分类名 > @Model.商品信息.所属商品分类.商品分类.父分类.商品分类.分类名 > @Model.商品信息.所属商品分类.商品分类.分类名
                            </span>
                        }
                    </div>
                    @if (Model.中标商品)
                    {
                        var numstr = "";
                        <div class="product_add_textarabox">
                            <div class="product_add_toptitle">商品类型：</div>
                            <span style="color:red;font-size:13px;"> 中标商品</span>
                        </div>
                        for (var index = 0; index < Model.中标信息.Count; index++)
                        {
                            numstr += index + "|";
                            if (index == 0)
                            {
                                <div class="product_add_textarabox">
                                    <div style="float:left;padding-right:5px;">
                                        <div class="product_add_toptitle">项目编号：</div>
                                        <input type="text" value="@Model.中标信息[index].中标项目编号" id="pronum___@(index)" name="pronum___@(index)" style="width: 130px;" />
                                        <span style="float: left;">*</span>
                                    </div>
                                    <div style="float:left;padding-right:5px;">
                                        <div class="product_add_toptitle">中标数量：</div>
                                        <input type="text" value="@Model.中标信息[index].中标数量" id="procount___@(index)" name="procount___@(index)" style="width: 130px;" />
                                        <span style="float: left;">*</span>

                                    </div>
                                    <div style="float:left;padding-right:5px;">
                                        <div class="product_add_toptitle">中标金额：</div>
                                        <input type="text" value="@Model.中标信息[index].中标金额" id="proprice___@(index)" name="proprice___@(index)" style="width: 130px;" />
                                        <span style="float: left;">*</span>
                                        <input type="button" style="width: 100px; float: left; height: 35px;" value="新增项目" id="deleteprobtn___@(index)" onclick="addpro(this)" />
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="product_add_textarabox">
                                    <div style="float:left;padding-right:5px;">
                                        <div class="product_add_toptitle">项目编号：</div>
                                        <input type="text" value="@Model.中标信息[index].中标项目编号" id="pronum___@(index)" name="pronum___@(index)" style="width: 130px;" />
                                        <span style="float: left;">*</span>
                                    </div>
                                    <div style="float:left;padding-right:5px;">
                                        <div class="product_add_toptitle">中标数量：</div>
                                        <input type="text" value="@Model.中标信息[index].中标数量" id="procount___@(index)" name="procount___@(index)" style="width: 130px;" />
                                        <span style="float: left;">*</span>
                                    </div>
                                    <div style="float:left;padding-right:5px;">
                                        <div class="product_add_toptitle">中标金额：</div>
                                        <input type="text" value="@Model.中标信息[index].中标金额" id="proprice___@(index)" name="proprice___@(index)" style="width: 130px;" />
                                        <span style="float: left;">*</span>
                                        <input type="button" style="width: 100px; float: left; height: 35px;" value="删除该项目" id="deleteprobtn___@(index)" onclick="deletepro(this)" />
                                    </div>
                                </div>
                            }
                        }
                        <input type="hidden" id="proliststr" name="proliststr" value="@numstr" />
                    }
                    <div class="product_add_textarabox" id="proneedproname">
                        <div class="product_add_toptitle">商品名称：</div>
                        @Html.EditorFor(model => model.商品信息.商品名)<span>*</span><span id="p_name" style="display: none;">请输入商品名称</span>
                        @*@Html.ValidationMessageFor(model => model.商品信息.商品名)*@
                    </div>
                    <div class="product_add_textarabox">
                        <div class="product_add_toptitle">商品品牌：</div>
                        @Html.EditorFor(model => model.商品信息.品牌)
                    </div>

                    <div class="product_add_textarabox">
                        <div class="product_add_toptitle">商品型号：</div>
                        @Html.EditorFor(model => model.商品信息.型号)<span>*</span><span id="p_xinghao" style="display: none;">请输入商品型号</span>
                    </div>
                    <div class="product_add_textarabox">
                        <div class="product_add_toptitle">计量单位：</div>
                        @Html.EditorFor(model => model.商品信息.计量单位)<span>*（如：个、辆等）</span><span id="p_jldw" style="display: none;">请输入计量单位</span>
                    </div>
                    @if (id == 200000001522)
                    {
                        <div class="product_add_textarabox">
                            <div class="product_add_toptitle">单位重量：</div><span style="padding-right: 20px;">千克(kg)</span>
                            @Html.TextBoxFor(model => model.商品信息.单位重量, new { id = "per_weight" })
                            @*@Html.ValidationMessageFor(model => model.商品信息.商品名)*@
                        </div>
                        <div class="product_add_textarabox">
                            <div class="product_add_toptitle">市场价格：</div>
                            @Html.TextBoxFor(model => model.销售信息.价格, new { id = "p_price1" })
                            @*@Html.ValidationMessageFor(model => model.销售信息.价格)*@<span style="padding-right: 20px;">*</span>
                        </div>
                        <div class="product_add_textarabox">
                            <div class="product_add_toptitle">军采价格：</div>
                            @Html.EditorFor(model => model.销售信息.军采价)<span style="padding-right: 20px;">*</span><span id="p_price1" style="display: none;">请输入正确的价格,只能为数字或小数</span>
                        </div>
                        <div class="product_add_textarabox">
                            <div class="product_add_toptitle">销售地域：</div>
                            @Html.HiddenFor(m => m.销售信息.销售地域.省份, new { id = "province1" })
                            @Html.HiddenFor(m => m.销售信息.销售地域.城市, new { id = "city1" })
                            @Html.HiddenFor(m => m.销售信息.销售地域.区县, new { id = "area1" })
                            <select id="province" name="province" style="width:100px;"></select>
                            <select id="city" name="city" style="width:100px;"></select>
                            <select id="area" name="area" style="width:100px;"></select>
                            <script>
                                window.onload = function () { new PCAS("province", "city", "area", "@Model.销售信息.销售地域.省份", "@Model.销售信息.销售地域.城市", "@Model.销售信息.销售地域.区县"); }
                            </script>
                        </div>
                    }
                    else
                    {
                        <div class="product_add_textarabox">
                            <div class="product_add_toptitle">军采价格：</div>
                            @Html.EditorFor(model => model.销售信息.价格)<span style="padding-right: 20px;">*</span><span id="p_price" style="display: none;">请输入正确的价格,只能为数字或小数</span>
                        </div>
                    }

                    <div class="product_add_textarabox">
                        <div class="product_add_toptitle">商品简介：</div>
                        @Html.TextAreaFor(model => model.商品数据.商品简介)<span>*</span><span id="p_des" style="display: none;">请输入商品简介</span>
                    </div>

                    <div class="product_add_detailbox" style="margin-bottom: 10px;">
                        <div class="product_add_toptitle">商品详情：</div>
                        @Html.TextAreaFor(model => model.商品数据.商品详情, new { style = "width: 698px; height: 400px; visibility: hidden; padding-left: 110px;", id = "content1" })
                        <div class="product_add_toptitle"></div><span id="p_detaildes" style="color: red; display: none;">请输入商品详情</span>
                    </div>
                    <div style="width: 300px; float: right;padding:20px 0 20px 0;">
                        <input type="button" value="下一步" class="index_online_btn" onclick='nextStep(1,0)'>
                    </div>
                </li>
            </ul>
            <ul style="padding:10px 0;">
                <li>
                    <span style="color:red; padding-left: 20px;" id="priceerrormessage"></span>
                    @if (Model.销售信息.价格属性组合.属性列表.Count > 0)
                    {
                        <div id="tablecontent" style="width: 900px; height: auto; margin: 0 auto; overflow: hidden; margin-bottom: 20px;">
                            <table class='product_att_table' cellpadding='0' cellspacing=' 0'>
                                <tr name='tr_th'>
                                    @foreach (var item in Model.销售信息.价格属性组合.属性列表)
                                    {
                                        <th class="product_att_table_th">@item</th>}
                                    <th class="product_att_table_th">价格匹配</th>
                                </tr>@foreach (var item in Model.销售信息.价格属性组合.组合列表)
                                {
                                    <tr name='table_tr'>
                                        @foreach (var ite in item.属性值表)
                                        {
                                            <td class="product_att_table_td">@ite</td>
                                        }
                                        <td class="product_att_table_td"><input style='border:none; width:100%; height:100%;' type='text' value="@item.价格" onblur='if($(this).val()==""){value="在这里输入价格";$(this).css("color","#aaa");}' onfocus='if($(this).val()=="在这里输入价格"){value="";$(this).css("color","#000");}' /></td>
                                    </tr>
                                }
                            </table>
                        </div>
                    }
                    else
                    {
                        <div id="tablecontent" style="width: 900px; height: auto; margin: 0 auto; overflow: hidden; display: none; margin-bottom: 20px;"></div>
                    }
                    <input name="pricesttrsrr" id="pricesttrsrr" type="hidden" />
                    <input name="sttrsrr" id="sttrsrr" type="hidden" />
                    <input name="classsttrsrr" id="classsttrsrr" type="hidden" value="@ViewData["classid"]" />
                    <input name="idsttrsrr" id="idsttrsrr" value="@ViewData["pro_id"]" type="hidden" />
                    <div class="product_add_attributebox" id="gys_product_class" style="margin: 0 auto;">
                        @foreach (var arr in (Dictionary<string, Dictionary<string, 商品属性数据>>)ViewData["商品属性模板"])
                        {
                            <div style=" width:898px; height:auto; overflow:hidden; margin:0 auto;" name="attrbox">
                                <div class="product_add_toptitle" style=" width:898px; float:left; background-color:#ccd2b0; text-align: left;">@arr.Key</div>
                                <table class="product_att_table" cellpadding="0" cellspacing="0" id="@arr.Key">
                                    @foreach (var item in arr.Value)
                                    {
                                        <tr id="@item.Key" name="@arr.Key">
                                            <td class="product_att_table_td_exp">
                                                @if (item.Value.属性类型 == 属性类型.复选 && item.Value.销售属性)
                                                {
                                                    if (Model.销售信息.价格属性组合.属性列表.Contains(item.Key))
                                                    {
                                                        <input type="checkbox" name="pricecheckbox" checked="checked" value="@item.Key" onclick=" gettablehead(this) " />
                                                    }
                                                    else
                                                    {
                                                        <input type="checkbox" name="pricecheckbox" value="@item.Key" onclick=" gettablehead(this) " />
                                                    }
                                                    <span title="点选价格属性,系统会根据您选择的值进行组合,不同的组合可以设置不同的价格!">价格属性</span>
                                                }
                                                else
                                                {
                                                    <input disabled="disabled" type="checkbox" value="@item.Key" onclick=" gettablehead(this) " /><span style="color:#cccccc">价格属性</span>
                                                }
                                            </td>
                                            <td class="product_att_table_td_exp1">
                                                @item.Key
                                            </td>
                                            <td width="100%" class="product_att_table_td">
                                                @try
                                                {
                                                    var vals = Model.商品数据.商品属性[arr.Key][item.Key];
                                                    if (item.Value.属性类型 == 属性类型.复选)
                                                    {
                                                        if (item.Value.销售属性)
                                                        {
                                                            foreach (var listitem in item.Value.值)
                                                            {
                                                                if (vals.Contains(listitem))
                                                                {
                                                                    <span class="product_att_table_span"><input type="checkbox" checked="checked" id="@listitem" name="@item.Key" value="@listitem" onclick=" gettablehead(this) " />@listitem</span>
                                                                }
                                                                else
                                                                {
                                                                    <span class="product_att_table_span"><input type="checkbox" id="@listitem" name="@item.Key" value="@listitem" onclick=" gettablehead(this) " />@listitem</span>
                                                                }
                                                            } //先遍历属性模板的值

                                                            if (Model.审核数据.审核状态 != 审核状态.审核通过)
                                                            {
                                                                foreach (var selfitem in vals)
                                                                {
                                                                    if (!item.Value.值.Contains(selfitem))
                                                                    {
                                                                        <span class="product_att_table_span"><a onclick=' $(this).parent().find("input:first").prop("checked", false);gettablehead(this); $(this).parent().remove(); ' class='proadd_deleteattr'></a><input type="checkbox" checked="checked" id="@selfitem" name="@item.Key" value="@selfitem" onclick=" gettablehead(this) " />@selfitem</span>
                                                                    }
                                                                } //再遍历属性自定义属性值---针对未通过或未审核的商品
                                                            }
                                                            <a onclick=" addattribute(this) " key="@item.Key" issale="1" class="proadd_addattr"></a>
                                                        }
                                                        else
                                                        {
                                                            foreach (var listitem in item.Value.值)
                                                            {
                                                                if (vals.Contains(listitem))
                                                                {
                                                                    <span class="product_att_table_span"><input type="checkbox" checked="checked" id="@listitem" name="@item.Key" value="@listitem" />@listitem</span>
                                                                }
                                                                else
                                                                {
                                                                    <span class="product_att_table_span"><input type="checkbox" id="@listitem" name="@item.Key" value="@listitem" />@listitem</span>
                                                                }
                                                            } //先遍历属性模板的值

                                                            if (Model.审核数据.审核状态 != 审核状态.审核通过)
                                                            {
                                                                foreach (var selfitem in vals)
                                                                {
                                                                    if (!item.Value.值.Contains(selfitem))
                                                                    {
                                                                        <span class="product_att_table_span"><a onclick=' $(this).parent().find("input:first").prop("checked", false); gettablehead(this); $(this).parent().remove(); ' class='proadd_deleteattr'></a><input type="checkbox" checked="checked" id="@selfitem" name="@item.Key" value="@selfitem" onclick=" gettablehead(this) " />@selfitem</span>
                                                                    }
                                                                } //再遍历属性自定义属性值---针对未通过或未审核的商品
                                                            }
                                                            <a onclick=" addattribute(this) " key="@item.Key" issale="0" class="proadd_addattr"></a>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        if (vals[0] == "")
                                                        {
                                                            <input style="border: none; width: 100%; height: 100%; color: #aaa;" type="text" name="@item.Key" value='在这里输入...' onblur="if ($(this).val() == '') { value = '在这里输入...'; $(this).css('color', '#aaa'); }" onfocus="if ($(this).val() == '在这里输入...') { value = ''; $(this).css('color', '#000'); }" />
                                                        }
                                                        else
                                                        {
                                                            <input style="border: none; width: 100%; height: 100%;" type="text" value="@vals[0]" name="@item.Key" />
                                                        }
                                                    }
                                                }
                                                catch
                                                {
                                                    if (item.Value.属性类型 == 属性类型.复选)
                                                    {
                                                        if (item.Value.销售属性)
                                                        {
                                                            foreach (var listitem in item.Value.值)
                                                            {

                                                                <span class="product_att_table_span"><input type="checkbox" id="@listitem" name="@item.Key" value="@listitem" onclick=" gettablehead(this) " />@listitem</span>
                                                            } //只遍历属性模板的值
                                                            <a onclick=" addattribute(this) " key="@item.Key" issale="1" class="proadd_addattr"></a>
                                                        }
                                                        else
                                                        {
                                                            foreach (var listitem in item.Value.值)
                                                            {
                                                                <span class="product_att_table_span"><input type="checkbox" id="@listitem" name="@item.Key" value="@listitem" />@listitem</span>
                                                            } //只遍历属性模板的值
                                                            <a onclick=" addattribute(this) " key="@item.Key" issale="0" class="proadd_addattr"></a>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <input style="border: none; width: 100%; height: 100%; color: #aaa;" type="text" name="@item.Key" value='在这里输入...' onblur="if ($(this).val() == '') { value = '在这里输入...'; $(this).css('color', '#aaa'); }" onfocus="if ($(this).val() == '在这里输入...') { value = ''; $(this).css('color', '#000'); }" />
                                                    }
                                                }
                                            </td>
                                        </tr>
                                    }
                                </table>
                            </div>
                        }
                    </div>

                    <div style="width: 300px; float: right;padding:20px 0 20px 0;">
                        <input type="button" value="上一步" class="index_online_btn" onclick="preStep(1,0)">
                        <input type="button" value="下一步" class="index_online_btn" onclick="nextStep(3,3)">
                    </div>
                </li>
            </ul>
            <ul>
                <li>
                    <div class="product_add_textarabox">
                        <div class="product_add_toptitle">售后服务：</div>
                        @Html.TextAreaFor(model => model.商品数据.售后服务, new { style = "width: 698px; height: 400px; visibility: hidden; padding-left: 110px;", id = "content2" })
                    </div>
                    <div style="width: 700px; float: right;padding:20px 0 20px 0; margin: 0 auto;">
                        <div style="width: 400px; float: left">
                            <span id="contenerror" style=" padding-left:20px; color:red; font-weight:normal; width: 200px;"></span>
                        </div>

                        <div style="width: 300px; float: left">
                            <input type="button" value="上一步" class="index_online_btn" onclick="preStep(2,2)">
                            <input type="submit" name="submitcontent" class="index_online_btn" value="完成" onclick="return getatt();" @*onclick="getpropertystr();"*@ />
                            <br />
                            <span id="contenerror" style="color:red; font-weight:normal; width: 200px;"></span>
                        </div>
                    </div>
                </li>
            </ul>
                        string str = "";
                        string str1 = "";
                        if (Model.商品信息.商品图片 != null && Model.商品信息.商品图片.Count > 0)
                        {
                            foreach (var item in Model.商品信息.商品图片)
                            {
                                str += item + "|";
                            }
                        }
                        if (Model.商品信息.商品型号图片 != null && Model.商品信息.商品型号图片.Any())
                        {
                            foreach (var item in Model.商品信息.商品型号图片)
                            {
                                str1 += item + "|";
                            }
                        }
                        <input type="hidden" id="oldpicture" name="oldpicture" value="@str" />
                        <input type="hidden" id="oldpicture1" name="oldpicture1" value="@str1" />
                        <input type="hidden" id="picture" name="pro_imgstr" style="width:500px; height:100px;" />
                        <input type="hidden" id="picture1" name="pro_imgstr1" style="width:500px; height:100px;" />

        }
    </div>
</div>
<script type="text/javascript">
    function filechange(number) {
        if(number==0)
        {
            document.forms["upload"].submit();
        }
        else
        {
            document.forms["upload1"].submit();
        }
        $("#f1").show();
    }
    $(function () {
        $('input[name="销售信息.价格"]').blur(function () {
            var pricerg = /^(:?(:?\d+.\d+)|(:?\d+))$/;
            var stepcheckparm = $('input[name="销售信息.价格"]');
            if ($.trim(stepcheckparm.val()) == "" || !(stepcheckparm.val().match(pricerg)) || stepcheckparm.val() == 0) {
                $("#p_price").show();
                $(stepcheckparm).focus();
            }
            else {
                $("#p_price").hide();
            }
        });

        $("#@ViewData["comes"]").css({ "background": "#537E2B" }).children("a").css({ "color": "#fff" });
        $("#@ViewData["comes"]").parents().attr("show", "true").show().prev("li").addClass("open").children("span").css({"background":"url('../Images/tree_icons.png') -115px -4px"});
    });
    function setTableInnerHTML(table, html) {
        if (navigator && navigator.userAgent.match(/msie/i)) {
            var temp = table.ownerDocument.createElement('div');
            temp.innerHTML = '<table><tbody>' + html + '</tbody></table>';
            if (table.tBodies.length == 0) {
                var tbody = document.createElement("tbody");
                table.appendChild(tbody);
            }
            table.replaceChild(temp.firstChild.firstChild, table.tBodies[0]);
        } else {
            table.innerHTML = html;
        }
    }
    function GetPriceList() {
        var retstr = "<tr><th width='200'>颜色</th><th width='300'>尺码</th><th width='298'>价格</th></tr>";
        var test = document.getElementsByName("color");
        for (i = 0; i < test.length ; i++) {
            if (test[i].type == "checkbox" && test[i].checked) {
                var testsize = document.getElementsByName("size");
                for (j = 0; j < testsize.length ; j++) {
                    if (testsize[j].type == "checkbox" && testsize[j].checked) {
                        document.getElementById("pricelist").style.display = 'block';
                        retstr += "<tr><td>" + test[i].value + "</td><td>" + testsize[j].value + "</td><td><input type=text /></td></tr>"
                    }
                }
            }
        }
        var tablecontent = document.getElementById("pricelist");
        setTableInnerHTML(tablecontent, retstr);
    }

    function change_tbl(obj,num) {
        $("div#listdiv ul li").each(function () {
            $(this).removeClass("cli");
        });
        $(obj).attr("class", "cli");
        $("div#product_tabmenu_content ul").each(function () {
            $(this).hide();
        });
        $("div#product_tabmenu_content ul:eq(" + num + ")").show();
    }
    $(document).ready(function () {

        $("table tr td :input").mouseover(function () { $(this).next("div").show(); $(this).next("div").css("display", "inline-block"); });
        $("table tr td :input").mouseout(function () { $(this).next("div").hide(); });
    });
</script>

<script type="text/javascript">
    function deleteattach(th,num) {
        var id = $(th).attr("id");
        var path = $(th).attr("title");
        $.get('/供应商后台/DeleteImages', { n: path,gid:id,number:num},
            function (data) {
                if (data == 1) {
                    $(th).parent().parent().remove();
                }
            });
        if(num==0)
        {
            var newpath = document.getElementById("oldpicture").value.split('|');
            var str = "";
            for (j = 0; j < newpath.length - 1; j++) {
                if (path != newpath[j]) {
                    str += newpath[j] + "|";
                }
            }
            document.getElementById("oldpicture").value = str;
        }
        else
        {
            var newpath = document.getElementById("oldpicture1").value.split('|');
            var str = "";
            for (j = 0; j < newpath.length - 1; j++) {
                if (path != newpath[j]) {
                    str += newpath[j] + "|";
                }
            }
            document.getElementById("oldpicture1").value = str;
        }
    }
    function addattribute(a) {
        var flag = true;

        var str = prompt("请输入值", "");
        if (null != str && "" != str) {

            //判断合法性
            if (str.indexOf("||||") > -1 || str.indexOf("^^^^") > -1 || str.indexOf("####") > -1 || str.indexOf("****") > -1 || str.indexOf("$$$$") > -1) {
                alert("不能包含非法字符！");
                return;
            }

            //判断是否存在该值
            var td = $(a).parent();
            td.find("input").each(function () {
                //alert($(this).val());
                if ($(this).val() == str) {
                    alert("已经存在该值，不能重复添加！");
                    flag = false;
                    return false;
                }
            });

            if (flag) {
                var key = a.getAttribute("key");
                var issale = a.getAttribute("issale");
                if (issale == "1") {
                    $(a).before("<span class='product_att_table_span'><a onclick='$(this).parent().find(\"input:first\").prop(\"checked\",false);gettablehead(this);$(this).parent().remove();' class='proadd_deleteattr'></a><input type='checkbox' id='" + str + "' name='" + key + "' value='" + str + "' onclick='gettablehead(this)' />" + str + "</span>");
                }
                if (issale == "0") {
                    $(a).before("<span class='product_att_table_span'><a onclick='$(this).parent().remove();' class='proadd_deleteattr'></a><input type='checkbox' id='" + str + "' name='" + key + "' value='" + str + "' />" + str + "</span>");
                }
            }
            //alert(str);
        }
    }
    var num=0;
    $("#per_weight").keydown(function(){
        num=$(this).val();
    });
    $("#per_weight").keyup(function(){
        var reg=/\d{1,20}$|\d{1,20}[.]{0,1}\d{0,2}$/g;
        var str=$(this).val();
        if(!reg.test(str))
        {
            $(this).val(parseFloat(num));
        }
    });
    var num1 = 0;
    $("#p_price1").keydown(function () {
        num = $(this).val();
    });
    $("#p_price1").keyup(function () {
        var reg = /\d{1,20}$|\d{1,20}[.]{0,1}\d{0,2}$/g;
        var str = $(this).val();
        if (!reg.test(str)) {
            $(this).val(parseFloat(num));
        }
    });
</script>
<script type="text/javascript">
    function gettablehead(a) {

        //防止每次选择复选框价格清零
        if ($(a).attr("name") != "pricecheckbox") {
            if (!$(a).parent().parent().parent().find("input:first").is(":checked")) {
                return false;
            }
        }

        document.getElementById("tablecontent").innerHTML = "";

        var ischeck = false;
        var count = 0;
        var arrtd = new Array();
        var tableheadstr = "<tr name='tr_th'>";
        var outbox = document.getElementsByName("pricecheckbox");
        for (var i = 0; i < outbox.length && count <= 2; i++) {
            if (outbox[i].type == "checkbox" && outbox[i].checked) {
                ischeck = true;
                tableheadstr += "<th class='product_att_table_th'>" + outbox[i].value + "</th>";
                arrtd[count] = outbox[i].value;
                count++;
            }
        }
        //只允许3种价格匹配<=2
        if (ischeck) {

            tableheadstr += "<th class='product_att_table_th'>价格匹配</th></tr>";

            var tdcountent = "";
            if (arrtd.length == 1) {
                outbox = document.getElementsByName(arrtd[0]);

                for (var j = 0; j < outbox.length ; j++) {
                    if (outbox[j].type == "checkbox" && outbox[j].checked) {
                        tdcountent += "<tr name='table_tr'><td class='product_att_table_td'>" + outbox[j].value + "</td><td class='product_att_table_td'><input style='border:none; width:100%; height:100%; color:#aaa;' type='text' value='在这里输入价格' onblur=\"if ($(this).val() ==''){value='在这里输入价格';$(this).css('color','#aaa');}\" onfocus=\"if ($(this).val() =='在这里输入价格'){value ='';$(this).css('color','#000');}\" /></td><tr>";
                    }
                }
                //tdcountent += "<td><input type='text' /></td>";
            }
            if (arrtd.length == 2) {
                var test = document.getElementsByName(arrtd[0])
                for (i = 0; i < test.length ; i++) {
                    if (test[i].type == "checkbox" && test[i].checked) {
                        var testsize = document.getElementsByName(arrtd[1]);
                        for (j = 0; j < testsize.length ; j++) {
                            if (testsize[j].type == "checkbox" && testsize[j].checked) {

                                tdcountent += "<tr name='table_tr'><td class='product_att_table_td'>" + test[i].value + "</td><td  class='product_att_table_td'>" + testsize[j].value + "</td><td class='product_att_table_td'><input style='border:none; width:100%; height:100%; color:#aaa;' type='text' value='在这里输入价格' onblur=\"if ($(this).val() ==''){value='在这里输入价格';$(this).css('color','#aaa');}\" onfocus=\"if ($(this).val() =='在这里输入价格'){value ='';$(this).css('color','#000');}\" /></td></tr>"
                            }
                        }
                    }
                }
                //tdcountent += "<td><input type='text' /></td>";
            }
            if (arrtd.length == 3) {
                var test = document.getElementsByName(arrtd[0]);
                for (i = 0; i < test.length ; i++) {
                    if (test[i].type == "checkbox" && test[i].checked) {
                        var testsize = document.getElementsByName(arrtd[1]);
                        for (var j = 0; j < testsize.length ; j++) {
                            if (testsize[j].type == "checkbox" && testsize[j].checked) {

                                var testsize3 = document.getElementsByName(arrtd[2]);
                                for (var k = 0; k < testsize3.length ; k++) {
                                    if (testsize3[k].type == "checkbox" && testsize3[k].checked) {

                                        tdcountent += "<tr name='table_tr'><td class='product_att_table_td'>" + test[i].value + "</td><td class='product_att_table_td'>" + testsize[j].value + "</td><td  class='product_att_table_td'>" + testsize3[k].value + "</td><td class='product_att_table_td'><input style='border:none; width:100%; height:100%; color:#aaa;' type='text' value='在这里输入价格' onblur=\"if ($(this).val() ==''){value='在这里输入价格';$(this).css('color','#aaa');}\" onfocus=\"if ($(this).val() =='在这里输入价格'){value ='';$(this).css('color','#000');}\" /></td></tr>";
                                    }
                                }

                            }
                        }
                    }
                }
                //tdcountent += "<td><input type='text' /></td>";
            }

            var tablestr = "<table class='product_att_table' cellpadding='0' cellspacing=' 0'>" + tableheadstr + tdcountent + "</table>";
            if (tdcountent == "") {
                $("#tablecontent").hide();
            } else {
                $("#tablecontent").show();
                document.getElementById("tablecontent").innerHTML = tablestr;
            }
        } else {
            $("#tablecontent").hide();
        }
    }
    function checkform() {
        var pricerg = /^(:?(:?\d+.\d+)|(:?\d+))$/;

        //验证项目编号
        if ($("#proliststr").length >= 1) {
            var pronamelist = $("#proliststr").val().substring(0, $("#proliststr").val().length - 1).split('|');
            for (var proindex = 0; proindex < pronamelist.length; proindex++) {
                if ($.trim($("#pronum___" + pronamelist[proindex]).val()) == "") {
                    $("#contenerror").html("商品描述-->项目名称必须填写");
                    return false;
                }
            }
        }

        //验证商品名称
        var stepcheckparm = $('input[name="商品信息.商品名"]');
        if ($.trim(stepcheckparm.val()) == "") {
            $("#contenerror").html("商品描述-->商品名称必须填写");
            return false;
        }

        //验证商品型号
        stepcheckparm = $('input[name="商品信息.型号"]');
        if ($.trim(stepcheckparm.val()) == "") {
            $("#contenerror").html("商品描述-->商品型号必须填写");
            return false;
        }

        //验证商品计量单位
        stepcheckparm = $('input[name="商品信息.计量单位"]');
        if ($.trim(stepcheckparm.val()) == "") {
            $("#contenerror").html("商品描述-->计量单位必须填写");
            return false;
        }

        //验证商品价格
        stepcheckparm = $('input[name="销售信息.价格"]');
        if ($.trim(stepcheckparm.val()) == "" || !(stepcheckparm.val().match(pricerg)) || stepcheckparm.val() == 0) {
            $("#contenerror").html("商品描述-->军采价格填写有误");
            return false;
        }

        //验证商品简介
        stepcheckparm = $('textarea[name="商品数据.商品简介"]');
        if ($.trim(stepcheckparm.val()) == "") {
            $("#contenerror").html("商品描述-->商品简介必须填写");
            return false;
        }

        //var pricerg = /^(:?(:?\d+.\d+)|(:?\d+))$/;
        editor1.sync("content1");
        if ($.trim($("#content1").val()) == "") {
            $("#contenerror").html("商品描述-->商品详情必须填写");
            return false;
        }




        $("#contenerror").html("");
        return true;
    }

    function getatt() {
        var pricerg = /^(:?(:?\d+.\d+)|(:?\d+))$/;

        if (!checkform()) {
            return false;
        }

        var retstr = "";

        var att_table = document.getElementById("gys_product_class").getElementsByTagName("table");
        for (var i = 0; i < att_table.length; i++) {
            retstr += att_table[i].getAttribute("id") + "||||";

            var att_tr = att_table[i].getElementsByTagName("tr");
            for (var j = 0; j < att_tr.length; j++) {
                retstr += att_tr[j].getAttribute("id") + "^^^^";

                var att_td = att_tr[j].getElementsByTagName("td")[2];
                var att_input = att_td.getElementsByTagName("input");

                for (var k = 0 ; k < att_input.length; k++) {
                    if (att_input[k].type == "checkbox" && att_input[k].checked) {
                        retstr += att_input[k].value + "####";
                    }
                    if (att_input[k].type == "text") {

                        if (att_input[k].value.indexOf("||||") > -1 || att_input[k].value.indexOf("^^^^") > -1 || att_input[k].value.indexOf("####") > -1 || att_input[k].value.indexOf("****") > -1 || att_input[k].value.indexOf("$$$$") > -1) {
                            alert("不能包含非法字符！");
                            att_input[k].focus();
                            return false;
                        }
                        if (att_input[k].value != "在这里输入...") {
                            retstr += att_input[k].value + "####";
                        } else {
                            retstr += "" + "####";
                        }
                    }
                }
                retstr += "****";

            }
            retstr += "$$$$";
        }
        document.getElementById("sttrsrr").value = retstr;


        var pricestr = "";
        var tr_thcontent = document.getElementsByName("tr_th");//价格匹配表头
        var trcontent = document.getElementsByName("table_tr");//价格匹配表格内容td
        if (trcontent.length > 0) {
            var tdcont = trcontent[0].childNodes.length;

            //一个条件作为价格组合--2列
            if (tdcont == 2) {
                pricestr += tr_thcontent[0].childNodes[0].innerHTML + "^^^^";
            }

            //两个条件作为价格组合--3列
            if (tdcont == 3) {
                pricestr += tr_thcontent[0].childNodes[0].innerHTML + "||||" + tr_thcontent[0].childNodes[1].innerHTML + "^^^^";
            }

            //三个条件作为价格组合--4列
            if (tdcont == 4) {
                pricestr += tr_thcontent[0].childNodes[0].innerHTML + "||||" + tr_thcontent[0].childNodes[1].innerHTML + "||||" + tr_thcontent[0].childNodes[2].innerHTML + "^^^^";
            }

            //trcontent.length==>价格匹配总行数
            for (i = 0; i < trcontent.length; i++) {
                var tdcontent = trcontent[i].childNodes;

                //一个条件作为价格组合--2列
                if (tdcont == 2) {
                    if (!((tdcontent[1].getElementsByTagName("input")[0].value).match(pricerg)) || tdcontent[1].getElementsByTagName("input")[0].value == 0) {
                        $("#priceerrormessage").html("价格填写有误!");
                        $("#contenerror").html("商品属性-->价格匹配填写有误");
                        tdcontent[1].getElementsByTagName("input")[0].focus();
                        return false;
                    }
                    else {
                        $("#priceerrormessage").html("");
                    }

                    pricestr += tdcontent[1].getElementsByTagName("input")[0].value + "####" + tdcontent[0].innerHTML + "&&&&";
                }

                //两个条件作为价格组合--3列
                if (tdcont == 3) {

                    if (!((tdcontent[2].getElementsByTagName("input")[0].value).match(pricerg)) || tdcontent[2].getElementsByTagName("input")[0].value == 0) {
                        $("#priceerrormessage").html("价格填写有误!");
                        $("#contenerror").html("商品属性-->价格匹配填写有误");
                        tdcontent[2].getElementsByTagName("input")[0].focus();
                        return false;
                    }
                    else {
                        $("#priceerrormessage").html("");
                    }

                    pricestr += tdcontent[2].getElementsByTagName("input")[0].value + "####" + tdcontent[0].innerHTML + "||||" + tdcontent[1].innerHTML + "&&&&";
                }

                //两个条件作为价格组合--3列
                if (tdcont == 4) {

                    if (!((tdcontent[3].getElementsByTagName("input")[0].value).match(pricerg)) || tdcontent[3].getElementsByTagName("input")[0].value == 0) {
                        $("#priceerrormessage").html("价格填写有误!");
                        $("#contenerror").html("商品属性-->价格匹配填写有误");
                        tdcontent[3].getElementsByTagName("input")[0].focus();
                        return false;
                    }
                    else {
                        $("#priceerrormessage").html("");
                    }

                    pricestr += tdcontent[3].getElementsByTagName("input")[0].value + "####" + tdcontent[0].innerHTML + "||||" + tdcontent[1].innerHTML + "||||" + tdcontent[2].innerHTML + "&&&&";
                }
            }
            //alert(pricestr);
            document.getElementById("pricesttrsrr").value = pricestr;
        }
    }
    function setPic(th) {
        var str = "<table>";
        var path = $(th).val();
        var path1 = path.split('|');
        var row = parseInt((path1.length - 1) / 4);
        var maintain = parseInt((path1.length - 1) % 4);
        var count = 0;
        if (row > 0) {
            for (var i = 0; i < row; i++) {
                str += "<tr>";
                for (var j = 0; j < 4; j++) {
                    if(th == "#picture")
                    {
                        str += "<td style='position:relative;'><img style='border:1px solid gray;top:0px;left:0px;' alt='" + path1[count] + "' src='" + path1[count] + "' width='100' height='80' /><a title='删除' id='' href='###' onclick='delPic(this,0)' class='deletebt' lang='" + path1[count] + "'>×</a></td>"
                    }
                    else
                    {
                        str += "<td style='position:relative;'><img style='border:1px solid gray;top:0px;left:0px;' alt='" + path1[count] + "' src='" + path1[count] + "' width='100' height='80' /><a title='删除' id='' href='###' onclick='delPic(this,1)' class='deletebt' lang='" + path1[count] + "'>×</a></td>"
                    }
                    count++;
                }
                str += "</tr>";
            }
        }
        if (maintain > 0) {
            str += "<tr>";
            for (var m = 0; m < maintain; m++) {
                if(th=="#picture")
                {
                    str += "<td style='position:relative;'><img style='border:1px solid gray;top:0px;left:0px;' alt='" + path1[count] + "' src='" + path1[count] + "' width='100' height='80' /><a title='删除' id='' href='###' onclick='delPic(this,0)' class='deletebt' lang='" + path1[count] + "'>×</a></td>";
                }
                else
                {
                    str += "<td style='position:relative;'><img style='border:1px solid gray;top:0px;left:0px;' alt='" + path1[count] + "' src='" + path1[count] + "' width='100' height='80' /><a title='删除' id='' href='###' onclick='delPic(this,1)' class='deletebt' lang='" + path1[count] + "'>×</a></td>";
                }
                count++;
            }
            str += "</tr>";
        }
        str += "</table>";
        if (th == "#picture1")
        {
            document.getElementById("pBox1").innerHTML = str;
        }
        else
        {
            document.getElementById("pBox").innerHTML = str;
        }
        $("#f1").hide();
    }
    function delPic(th,num) {
        if(confirm("确定删除吗？"))
        {
            var id = $(th).attr("id");
            var path = $(th).attr("lang");
            $.get('/供应商后台/DeleteImages', { n: path,gid:id },
                function (data) {
                    if (data == 1) {
                        $(th).parent().remove();
                    }
                });
            if(num==0)
            {
                var newpath = document.getElementById("picture").value.split('|');
                var str = "";
                for (j = 0; j < newpath.length - 1; j++) {
                    if (path != newpath[j]) {
                        str += newpath[j] + "|";
                    }
                }
                document.getElementById("picture").value = str;
                setPic("#picture");
            }
            else
            {
                var newpath = document.getElementById("picture1").value.split('|');
                var str = "";
                for (j = 0; j < newpath.length - 1; j++) {
                    if (path != newpath[j]) {
                        str += newpath[j] + "|";
                    }
                }
                document.getElementById("picture1").value = str;
                setPic("#picture1");
            }
        }
    }
    $("#province").change(function () {
        $("#province1").val($(this).val());
    });
    $("#city").change(function () {
        $("#city1").val($(this).val());
    });
    $("#area").change(function () {
        $("#area1").val($(this).val());
    });
</script>
