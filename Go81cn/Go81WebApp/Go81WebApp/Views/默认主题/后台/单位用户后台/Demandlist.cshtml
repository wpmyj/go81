@model IEnumerable<Go81WebApp.Models.数据模型.需求计划模型.需求计划>
@{
    ViewBag.Title = "需求计划列表";
    Layout = "_Back_IntranetLayout.cshtml";
}
@using Go81WebApp.Models.数据模型
@using Go81WebApp.Models.数据模型.用户数据模型
<script type="text/javascript" src="~/JS/My97DatePicker/calendar.js"></script>
<script type="text/javascript" src="~/JS/My97DatePicker/config.js"></script>
<script type="text/javascript" src="~/JS/My97DatePicker/WdatePicker.js"></script>
<link href="~/css/Msg_Tips.css" rel="stylesheet" />
<style>
    .out_box {
        display: none;
    }

    .icon {
        display: inline-block;
        width: 10px;
        height: 10px;
        background: url(/Images/tree_icons.png) 0px -5px;
    }

    .out_box_infirst {
        position: fixed;
        z-index: 5;
        top: 0px;
        left: 0px;
        text-align: center;
        right: 0;
        bottom: 0px;
        background-color: black;
        opacity: 0.5;
        -moz-opacity: 0.5;
        filter: alpha(opacity=50);
        height: 100%;
        width: 100%;
        border: 1px solid green;
        box-shadow: 0px 0px 10px gray;
        -webkit-box-shadow: 0px 0px 10px gray;
        -moz-box-shadow: 0px 0px 10px gray;
    }

    .out_box_insecond {
        position: fixed;
        width: 100%;
        height: 80%;
        left: 0px;
        z-index: 20;
        top: 3%;
    }

    .out_box_insecond_child {
        width: 630px;
        position: relative;
        margin: 0px auto;
        z-index: 100;
        background-color: white;
        border: 1px solid red;
    }

    .close_outbox {
        width: 30px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        background-color: red;
        font-size: 30px;
        color: white;
        float: right;
        cursor: pointer;
    }

    .addbt {
        display: inline-block;
        width: 100px;
        height: 30px;
        background-color: gray;
        color: white;
        text-align: center;
        line-height: 30px;
        margin-left: 10px;
    }

    #sbt {
        background-color: #207AD6;
        border: none;
        margin-top: 10px;
    }

    .notice {
        display: none;
        position: absolute;
        z-index: 20;
        width: 160px;
        height: auto;
        padding: 5px;
        border: 1px solid red;
        background-color: white;
        opacity: 0.9;
        filter: alpha(opacity=90);
        color: black;
        text-indent: 2em;
        font-size: 13px;
        text-align: left;
        line-height: 20px;
    }

    .name {
        display: inline-block;
        border-right: 1px solid white;
        cursor: pointer;
        width: 100px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        background-color: #ff0000;
        color: white;
    }

    .icon {
        display: inline-block;
        width: 10px;
        height: 10px;
        background: url(/Images/tree_icons.png) 0px -5px;
    }

    li input {
        margin-left: 30px;
    }

    div.pagerStyle {
        text-align: center;
        margin-top: 5px;
    }

        div.pagerStyle a, .gys_znxx_content_detailbox a {
            display: inline-block;
            width: 50px;
            text-align: center;
            line-height: 25px;
            font-size: 12px;
            height: 25px;
            border: 1px solid rgb(204, 204, 204);
            margin-left: 5px;
            margin-bottom: 5px;
            cursor: pointer;
        }

            div.pagerStyle a:hover {
                background-color: rgb(243, 243, 243);
            }

    .tabHeader {
        display: inline-block;
        height: 30px;
        text-align: center;
        line-height: 30px;
        font-size: 18px;
        width: 160px;
        color: white;
        cursor: pointer;
    }

    table tr td img {
        cursor: pointer;
        vertical-align: middle;
    }

    table.status {
        border: 1px solid #C2C2C2;
        border-top: none;
        border-left: none;
    }

        table.status th {
            border: 1px solid #C2C2C2;
            border-bottom: none;
            border-right: none;
            line-height: 30px;
        }

        table.status td {
            border: 1px solid #C2C2C2;
            border-bottom: none;
            border-right: none;
            line-height: 30px;
        }

    .tab {
        display: none;
    }

    #progress {
        margin-bottom: 10px;
    }

    div#tabHeader {
        width: 99%;
        margin-top: 10px;
        background-color: #ff006e;
    }

        div#tabHeader a {
            display: inline-block;
            width: 100px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            font-size: 18px;
            color: white;
        }

    #container table {
        border: 1px solid black;
        border-top: none;
        border-left: none;
    }

        #container table tr td, #container table tr th {
            border: 1px solid black;
            border-right: none;
            border-bottom: none;
        }

    .newbt {
        width: 150px;
        height: 30px;
        border: none;
        color: #fff;
        background-color: #207AD6;
        margin-left: 10px;
        margin-top: 10px;
        border-radius: 5px;
    }
</style>
@{
    IEnumerable<单位用户> m = ViewData["user"] as IEnumerable<单位用户>;
    Dictionary<int, string> way = ViewData["采购方式"] as Dictionary<int, string>;
}
<div id="pdf2" class="out_box">
    <div class="out_box_infirst">
    </div>
    <div class="out_box_insecond">
        <div class="out_box_insecond_child">
            <div style="width:100%; height:auto;"><a class="close_outbox" id="close" lang="" title="关闭窗口" onclick="hidebox1('#pdf2')">×</a></div>
            <div style="width:600px; height:auto;overflow:hidden;">
                <div>
                    <div>
                        <div><div style="text-align:center; line-height:30px;">当前需求处理单位如下：</div></div>
                        <div id="progress1">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@if ((int)ViewData["合并需求"] == 1)
{
    <div id="pdf1" class="out_box">
        <div class="out_box_infirst">
        </div>
        <div class="out_box_insecond">
            <div class="out_box_insecond_child">
                <div style="width:100%; height:auto;"><a class="close_outbox" title="关闭窗口" onclick="hidebox('#pdf1')">×</a></div>
                <div style="width:600px; min-height:115px; max-height:500px; overflow-y:scroll; overflow-x:hidden;">
                    <div>
                        <form action="/单位用户后台/addChecker" method="post" name="checker">
                            <input type="hidden" value="" id="did" name="Id" />
                            <input type="hidden" value="" id="uid" name="uid" />
                            <input type="hidden" value="" id="topuser" name="topuser" />
                            <div>
                                <div>
                                    <div style="text-align:center;"><span style="font-size:16px;font-weight:bold;">请选择审核单位</span><input type="button" class="newbt" id="adduser" value="新增审核单位" /><input type="button" class="newbt" id="addTopuser" value="新增上级助理员" /></div>
                                </div>
                                <table class="container" width="99%" cellspacing="5">
                                    <tr><td align="right">需求计划标题：</td><td><input name="需求计划标题" placeholder="请填写需求计划标题" style="width:200px;" /></td></tr>
                                    <tr>
                                        <td align="right">秘密等级：</td>
                                        <td>
                                            <select name="秘密等级" style=" margin-left:2px;width:200px;">
                                                <option value="0">未选择</option>
                                                <option value="3">秘密</option>
                                                <option value="2">机密</option>
                                                <option value="1">绝密</option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr><td align="right">编制单位：</td><td><input name="编制单位" placeholder="请填写编制单位" value="" style="width:200px;" /></td></tr>
                                    <tr><td align="right">承办部门：</td><td><input name="承办部门" placeholder="请填写承办部门" value="" style="width:200px;" /></td></tr>
                                    <tr><td align="right">采购年度：</td><td><input name="采购年度" placeholder="请填写采购年度" onfocus="WdatePicker({dateFmt:'yyyy/MM/dd'})" style="width:200px;" /></td></tr>
                                    <tr><td align="right">建议完成时间：</td><td><input name="建议完成时间" placeholder="请填写建议完成时间" onfocus="WdatePicker({dateFmt:'yyyy/MM/dd'})" style="width:200px;" /></td></tr>
                                    <tr><td align="right">联系人：</td><td><input name="联系人" placeholder="请填写联系人" value="" style="width:200px;" /></td></tr>
                                    <tr><td align="right">联系电话：</td><td><input name="联系电话" placeholder="请填写联系电话" style="width:200px;" /></td></tr>
                                    <tr>
                                        <td width="40%" align="right" valign="top">需求计划审核单位：</td>
                                        <td>
                                            <select class="user" style="width:204px;" name="name">
                                                <option value="-1">请选择审核单位</option>
                                                @foreach (var item in m)
                                                {
                                                    if (item.Id == 14)
                                                    {
                                                        <option selected="selected" value="@item.Id">
                                                            @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                                                            {
                                                                <text>@item.单位信息.单位代号</text>
                                                            }
                                                            else
                                                            {
                                                                <text>@item.单位信息.单位名称</text>
                                                            }
                                                            ：@item.联系方式.联系人
                                                        </option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.Id">
                                                            @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                                                            {
                                                                <text>@item.单位信息.单位代号</text>
                                                            }
                                                            else
                                                            {
                                                                <text>@item.单位信息.单位名称</text>
                                                            }
                                                            ：@item.联系方式.联系人
                                                        </option>
                                                    }
                                                }
                                            </select>
                                            <input type="button" value="删除" onclick="debefore(this, '')" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td align="right" valign="top">需求计划审核单位：</td>
                                        <td>
                                            <select class="user" style="width:204px;" name="name">
                                                <option value="-1">请选择审核单位</option>
                                                @foreach (var item in m)
                                                {
                                                    if (item.Id == 13)
                                                    {
                                                        <option selected="selected" value="@item.Id">
                                                            @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                                                            {
                                                                <text>@item.单位信息.单位代号</text>
                                                            }
                                                            else
                                                            {
                                                                <text>@item.单位信息.单位名称</text>
                                                            }：
                                                            @item.联系方式.联系人
                                                        </option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.Id">
                                                            @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                                                            {
                                                                <text>@item.单位信息.单位代号</text>
                                                            }
                                                            else
                                                            {
                                                                <text>@item.单位信息.单位名称</text>
                                                            }：
                                                            @item.联系方式.联系人
                                                        </option>
                                                    }
                                                }
                                            </select>
                                            <input type="button" value="删除" onclick="debefore(this,'')" />
                                        </td>
                                    </tr>
                                </table>
                                <table id="usertop" width="99%">
                                    <tr>
                                        <td width="40%" align="right" valign="top">需求计划上级审核单位：</td>
                                        <td>
                                            <select id="monitor" style="width:204px;" name="name">
                                                <option value="-1">请选择审核单位</option>
                                                @foreach (var item in m)
                                                {
                                                    if(item.Id==11)
                                                    {
                                                       <option selected="selected" value="@item.Id">
                                                        @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                                                        {
                                                            <text>@item.单位信息.单位代号</text>
                                                        }
                                                        else
                                                        {
                                                            <text>@item.单位信息.单位名称</text>
                                                        }：
                                                        @item.联系方式.联系人
                                                    </option> 
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.Id">
                                                        @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                                                        {
                                                            <text>@item.单位信息.单位代号</text>
                                                        }
                                                        else
                                                        {
                                                            <text>@item.单位信息.单位名称</text>
                                                        }：
                                                        @item.联系方式.联系人
                                                    </option>
                                                    }
                                                }
                                            </select>
                                            <input type="button" value="删除" onclick="debefore(this,'#usertop')" />
                                        </td>
                                    </tr>
                                </table>
                                <div style="text-align:center; margin:0px auto;">
                                    <input class="addbt" id="sbt" value="保存" onclick="subform('checker')" style="margin-bottom:10px;" type="button" />
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div id="pdf1" class="out_box">
        <div class="out_box_infirst">
        </div>
        <div class="out_box_insecond">
            <div class="out_box_insecond_child">
                <div style="width:100%; height:auto;"><a class="close_outbox" title="关闭窗口" onclick="hidebox('#pdf1')">×</a></div>
                <div style="width:600px; height:115px; overflow-y:scroll; overflow-x:hidden;">
                    <div>
                        <form action="/单位用户后台/SubDemand" method="post">
                            <input type="hidden" value="" id="did" name="id" />
                            <div>
                                <div>
                                    <div style="text-align:center;">请选择计划审核单位</div>
                                </div>
                                <table id="container" width="99%">
                                    <tr>
                                        <td align="right" valign="top">计划审核单位：</td>
                                        <td>
                                            <select id="user" style="width:204px;" name="name">
                                                <option value="-1">请选择计划审核单位</option>
                                                @foreach (var item in m)
                                                {
                                                    if(item.Id==11)
                                                    {
                                                        <option selected="selected" value="@item.Id">
                                                        @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                                                        {
                                                            <text>@item.单位信息.单位代号</text>
                                                        }
                                                        else
                                                        {
                                                            <text>@item.单位信息.单位名称</text>
                                                        }：@item.联系方式.联系人
                                                    </option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.Id">
                                                        @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                                                        {
                                                            <text>@item.单位信息.单位代号</text>
                                                        }
                                                        else
                                                        {
                                                            <text>@item.单位信息.单位名称</text>
                                                        }：@item.联系方式.联系人
                                                    </option>
                                                    }
                                                }
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                                <div style="text-align:center; margin:0px auto;">
                                    <input class="addbt" id="sbt" value="提交" type="submit" />
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<div class="bg_outdiv">
    <div class="bg_outdiv_left">
        @Html.Action("LeftMenu", "布局")
    </div>
    <div style="margin-bottom:50px;" class="bg_outdiv_right">
        <div class="title-base-out" style="width:100%">
            <div class="title-base-middle" style="width:100%">
                <div class="title-base-inner">需求清单<a href="/单位用户后台/Add_Demand" style="color:red;">【新增】</a></div>
            </div>
        </div>
        <div id="template" style="display:none;">
            <select class="user" style="width:204px;" name="name">
                <option value="-1">请选择审核单位</option>
                @foreach (var item in m)
                {
                    if(item.Id==14)
                    {
                        <option selected="selected" value="@item.Id">
                        @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                        {
                            <text>@item.单位信息.单位代号</text>
                        }
                        else
                        {
                            <text>@item.单位信息.单位名称</text>
                        }：@item.联系方式.联系人
                    </option>
                    }
                    else
                    {
                        <option value="@item.Id">
                        @if (!string.IsNullOrWhiteSpace(item.单位信息.单位代号))
                        {
                            <text>@item.单位信息.单位代号</text>
                        }
                        else
                        {
                            <text>@item.单位信息.单位名称</text>
                        }：@item.联系方式.联系人
                    </option>
                    }
                }
            </select>
            <input type="button" value="删除" onclick="debefore(this,'')" />
        </div>
        <div>
            <div>
                <div class="gys_znxx_content">
                    <div style="background-color:#207AD6;">
                        <a class="tabHeader" style="background-color:#D67C24;" onclick="showItem(this,'#container2')">我的需求计划</a><a class="tabHeader" onclick="showItem(this,'#container1')">合并后的需求计划</a>
                    </div>
                    <div id="outbox">
                        <div id="container2" style="margin-top:20px;">
                            <div>
                                审核状态：<select id="progress" onchange="getItems(1,1)">
                                    <option value="1">所有需求</option>
                                    <option value="2">未提交</option>
                                    <option value="6">待审核</option>
                                    <option value="3">审核中</option>
                                    <option value="4">审核通过</option>
                                    <option value="5">审核未通过</option>
                                </select>
                            </div>
                            <div id="tabItem">

                            </div>
                            <div class="pagerStyle" id="pager"></div>
                        </div>

                        <div id="container1" style="display:none;margin-top:20px;">
                            <div>
                                审核状态：<select id="progress2" onchange="getItems1(1,2)">
                                    <option value="1">所有需求</option>
                                    <option value="2">未提交</option>
                                    <option value="6">待审核</option>
                                    <option value="3">审核中</option>
                                    <option value="4">审核通过</option>
                                    <option value="5">审核未通过</option>
                                </select>
                            </div>
                            <div id="tabItem1">

                            </div>
                            <div class="pagerStyle" id="pager1"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var material = "";
    var distribute = "";
    var reg = /[0-9]/g;
    function showBox(th, th1) {
        $.get('/单位用户后台/getChildren', { id: $(th1).attr("lang") }, function (data) {
            $("input[name='需求计划标题']").val(data.Data.items[0].title);
            $("input[name='秘密等级']").val(data.Data.items[0].security);
            $("input[name='编制单位']").val(data.Data.items[0].bzdw);
            $("input[name='承办部门']").val(data.Data.items[0].depart);
            $("input[name='采购年度']").val(data.Data.items[0].cgyear);
            $("input[name='建议完成时间']").val(data.Data.items[0].time);
            $("input[name='联系人']").val(data.Data.items[0].contactMan);
            $("input[name='联系电话']").val(data.Data.items[0].phone);
            $("select[name='秘密等级']").children("option").each(function () {
                if ($(this).val() == data.Data.items[0].security) {
                    $(this).attr("selected", "selected");
                }
            });
        });
        $(th).show();
        if (th == "#pdf1") {
            $("#did").val($(th1).attr("lang"));
        }
    }


    function sendSummaryData() {
        if ($("#需求计划标题").val() == "") {
            alert("需求计划标题必须填写！");
            $("#需求计划标题").focus();
            return false;
        }
        if ($("#编制单位").val() == "") {
            alert("编制单位必须填写！");
            $("#编制单位").focus();
            return false;
        }
        if ($("#承办部门").val() == "") {
            alert("承办部门必须填写！");
            $("#承办部门").focus();
            return false;
        }
        if ($("#采购年度").val() == "") {
            alert("采购年度必须填写！");
            $("#采购年度").focus();
            return false;
        }
        if ($("#建议完成时间").val() == "") {
            alert("建议完成时间必须填写！");
            $("#建议完成时间").focus();
            return false;
        }
        if ($("#联系人").val() == "") {
            alert("联系人必须填写！");
            $("#联系人").focus();
            return false;
        }
        if ($("#联系电话").val() == "") {
            alert("联系电话必须填写！");
            $("#联系电话").focus();
            return false;
        }
        if ($("#auditunitlist").val() == "") {
            alert("至少应有一个审核单位，请点击上方新增审核单位按钮或新增上级助理员按钮进行添加！");
            return false;
        }
    }



    function hidebox(th) {
        $(th).hide();
    }
    function showNotice(th) {
        $(th).next("div.notice").show();
    }
    function hideNotice(th) {
        $(th).next("div.notice").hide();
    }
    $(".name").mouseover(function () {
        var index = $(this).attr("lang");
        $(".name").each(function () {
            $(this).css({ "background-color": "red" });
        });
        $(this).css({ "background-color": "#4197F0" });
        $(".tab").each(function () {
            $(this).hide();
        });
        $(".tab:eq(" + index + ")").show();
    });
    $("#user").change(function () {
        if ($(this).val() != -1) {
            $(":input#sbt").val("提交");
        }
        else {
            $(":input#sbt").val("保存");
        }
    });
    function delMaterial(th) {
        $(th).parentsUntil("div").remove();
    }
    function setPage(pgCount, currentPage, type) {
        if (pgCount <= 6) {
            var str = '';
            for (var i = 1; i <= pgCount; i++) {
                str += "<a onclick='getItems(" + i + "," + type + ")'>" + i + "</a>";
            }
            if (pgCount != 0) {
                str += "<span>" + currentPage + "/" + pgCount + "页</span>";
            }
            if (type == 1) {
                $("div#pager").html(str);
            }
            else {
                $("div#pager1").html(str);
            }
        }
        else {
            if (currentPage < 6) {
                if (currentPage != 1) {
                    var str = "<a onclick='getItems(" + (currentPage - 1) + "," + type + ")'>上一页</a>";
                    for (var i = 1; i < 7; i++) {
                        str += "<a onclick='getItems(" + i + "," + type + ")'>" + i + "</a>";
                    }
                    str += "...<a  onclick='getItems(" + pgCount + "," + type + ")'>" + pgCount + "</a><a onclick='getItems(" + (currentPage + 1) + "," + type + ")'>下一页</a>";
                    str += "<span>" + currentPage + "/" + pgCount + "页</span>";
                    if (type == 1) {
                        $("div#pager").html(str);
                    }
                    else {
                        $("div#pager1").html(str);
                    }
                }
                else {
                    var str = "";
                    for (var i = 1; i < 7; i++) {
                        str += "<a  onclick='getItems(" + i + "," + type + ")'>" + i + "</a>";
                    }
                    str += "...<a onclick='getItems(" + pgCount + "," + type + ")'>" + pgCount + "</a><a onclick='getItems(" + (currentPage + 1) + "," + type + ")'>下一页</a>";
                    str += "<span>" + currentPage + "/" + pgCount + "页</span>";
                    if (type == 1) {
                        $("div#pager").html(str);
                    }
                    else {
                        $("div#pager1").html(str);
                    }
                }
            }
            else if (currentPage >= 6 && currentPage < pgCount - 3) {
                var str = "<a onclick='getItems(" + (currentPage - 1) + "," + type + ")'>上一页</a><a onclick='getItems(" + (1) + "," + type + ")'>1</a>...";
                for (var i = (currentPage - 4 + 1) ; i <= currentPage + 1; i++) {
                    str += "<a onclick='getItems(" + i + "," + type + ")'>" + i + "</a>";
                }
                str += "...<a onclick='getItems(" + pgCount + "," + type + ")'>" + pgCount + "</a><a onclick='getItems(" + (currentPage + 1) + "," + type + ")'>下一页</a>";
                str += "<span>" + currentPage + "/" + pgCount + "页</span>";
                if (type == 1) {
                    $("div#pager").html(str);
                }
                else {
                    $("div#pager1").html(str);
                }
            }
            else if (currentPage >= pgCount - 3) {
                var str = "<a onclick='getItems(" + (currentPage - 1) + "," + type + ")'>上一页</a><a onclick='getItems(" + 1 + "," + type + ")'>1</a>...";
                for (var i = pgCount - 6 + 1; i <= pgCount; i++) {
                    str += "<a onclick='getItems(" + i + "," + type + ")'>" + i + "</a>";
                }
                str += "<span>" + currentPage + "/" + pgCount + "页</span>";
                if (type == 1) {
                    $("div#pager").html(str);
                }
                else {
                    $("div#pager1").html(str);
                }
            }
        }
        $("div#pager a").each(
            function () {
                if ($(this).text() == currentPage.toString()) {
                    $(this).css("border", "1px solid red");
                }
            }
        );
        $("div#pager1 a").each(
            function () {
                if ($(this).text() == currentPage.toString()) {
                    $(this).css("border", "1px solid red");
                }
            }
        );
    }
    function getItems(page, tp) {
        t = parseInt($("#progress").val());//
        $.get('/单位用户后台/DemandItems', { p: page, type: t }, function (data) {
            setPage(data.Data.Pcount, data.Data.Cpage, 1);
            var str = "";
            if (t == 5) {
                str = "<table style='margin-top:0px;' width='100%' cellpadding='0' cellspacing='0'><tr><th width='10%'>标题</th><th width='10%'>建议完成时间</th><th width='10%'>联系人</th><th width='10%'>联系电话</th><th width='10%'>审核状态</th><th width='10%'>发回原因</th><th width='30%'>操作</th></tr>";
            }
            else {
                str = "<table style='margin-top:0px;' width='100%' cellpadding='0' cellspacing='0'><tr><th width='10%'>标题</th><th width='10%'>建议完成时间</th><th width='10%'>联系人</th><th width='10%'>联系电话</th><th width='15%'>审核状态</th><th width='35%'>操作</th></tr>";
            }
            if (data.Data.items.length != 0) {
                for (var i = 0; i < data.Data.items.length; i++) {
                    switch (t) {
                        case 1:
                            if (data.Data.items[i].status == "待审核" || data.Data.items[i].status == "审核未通过" || data.Data.items[i].status == "未提交") {
                                if (data.Data.items[i].sum != 0) {
                                    str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>待审核<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "&page=1' target='_blank'>查看详情</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                                }
                                else {
                                    if (data.Data.items[i].status == "审核未通过" || data.Data.items[i].status == "未提交") {
                                        if (data.Data.items[i].status == "审核未通过") {
                                            str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "(<img onmouseover='showNotice(this)' onmouseout='hideNotice(this)' src='/Images/notice.png' style='width:20px;vertical-align:middle;' /><div class='notice'>" + data.Data.items[i].reason + "</div>)</td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>修改需求计划</a><a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='/单位用户后台/PlanDetail?id=" + data.Data.items[i].Id + "&&page=1' target='_blank'>查看审核详情</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr>";
                                        }
                                        else {
                                            str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>修改需求计划</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr>";
                                        }
                                    }
                                    else {
                                        str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                                    }
                                }
                            }
                            else {
                                if (data.Data.items[i].lastId) {
                                    if (data.Data.items[i].finish) {
                                        str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><span style='color:red'>审批流程已完成</span><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                                    }
                                    else {
                                        str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><input  alt='" + data.Data.items[i].Id + "' onclick='finish(this)' type='button' value='点击确认完成审批'/><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                                    }
                                }
                                else {
                                    str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                                }
                            }
                            break;
                        case 2:
                            if (data.Data.items[i].sum != 0) {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                            }
                            else {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>修改需求计划</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr>";
                            }
                            break;
                        case 3:
                            if (data.Data.items[i].sum != 0) {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                            }
                            else {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></td></tr>";
                            }
                            break;
                        case 4:
                            if (data.Data.items[i].lastId) {
                                if (data.Data.items[i].finish) {
                                    str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><span style='color:red'>审批流程已完成</span><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                                }
                                else {
                                    str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><input alt='" + data.Data.items[i].Id + "' onclick='finish(this)' type='button' value='点击确认完成审批'/><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                                }
                            }
                            else {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                            }
                            break;
                        case 5:
                            if (data.Data.items[i].count != 0) {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "</td><td style='text-align:center;'><img onmouseover='showNotice(this)' onmouseout='hideNotice(this)' src='/Images/notice.png' style='width:20px;vertical-align:middle;' /><div class='notice'>" + data.Data.items[i].reason + "</div><a href='###' class='progressBt'  onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='/单位用户后台/PlanDetail?id=" + data.Data.items[i].Id + "&&page=1' target='_blank'>查看审核详情</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr>";
                            }
                            else {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "</td><td style='text-align:center;'><img onmouseover='showNotice(this)' onmouseout='hideNotice(this)' src='/Images/notice.png' style='width:20px;vertical-align:middle;' /><div class='notice'>" + data.Data.items[i].reason + "</div><a href='###' class='progressBt' onclick='history(this)'  alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr>";
                            }
                            break;
                        case 6:
                            if (data.Data.items[i].sum != 0) {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                            }
                            else {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>修改需求计划</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></td></tr>";
                            }
                            break;
                    }
                }
            }
            else {
                str += "<tr><td colspan='7' style='color:red;'>还没有任何需求信息</td></tr>";
            }
            str += "</table>";
            $("#tabItem").html(str);
        });
    }
    function getItems1(page, tp) {
        t = parseInt($("#progress2").val());//
        $.get('/单位用户后台/DemandItems1', { p: page, type: t }, function (data) {
            setPage(data.Data.Pcount, data.Data.Cpage, 2);
            var str = "";
            if (t == 5) {
                str = "<table style='margin-top:10px;' width='100%' cellpadding='0' cellspacing='0'><tr><th width='10%'>标题</th><th width='10%'>建议完成时间</th><th width='10%'>联系人</th><th width='10%'>联系电话</th><th width='10%'>审核状态</th><th width='10%'>发回原因</th><th width='30%'>操作</th></tr>";
            }
            else {
                str = "<table style='margin-top:10px;' width='100%' cellpadding='0' cellspacing='0'><tr><th width='10%'>标题</th><th width='10%'>建议完成时间</th><th width='10%'>联系人</th><th width='10%'>联系电话</th><th width='15%'>审核状态</th><th width='35%'>操作</th></tr>";
            }
            if (data.Data.items.length != 0) {
                for (var i = 0; i < data.Data.items.length; i++) {
                    switch (t) {
                        case 1:
                            if (data.Data.items[i].status == "待审核" || data.Data.items[i].status == "审核未通过" || data.Data.items[i].status == "未提交") {
                                if (data.Data.items[i].sum != 0) {
                                    str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>待审核<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "&page=1' target='_blank'>查看详情</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr><tr></tr>";
                                }
                                else {
                                    if (data.Data.items[i].status == "审核未通过" || data.Data.items[i].status == "未提交") {
                                        if (data.Data.items[i].status == "审核未通过") {
                                            str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "(<img onmouseover='showNotice(this)' onmouseout='hideNotice(this)' src='/Images/notice.png' style='width:20px;vertical-align:middle;' /><div class='notice'>" + data.Data.items[i].reason + "</div>)</td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>修改需求计划</a><a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='/单位用户后台/PlanDetail?id=" + data.Data.items[i].Id + "&&page=1' target='_blank'>查看审核详情</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr><tr></tr>";
                                        }
                                        else {
                                            str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>修改需求计划</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr><tr></tr>";
                                        }
                                    }
                                    else {
                                        str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr><tr></tr>";
                                    }
                                }
                            }
                            else {
                                if (data.Data.items[i].lastId) {
                                    if (data.Data.items[i].finish) {
                                        str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><span style='color:red'>审批流程已完成</span><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr><tr></tr>";
                                    }
                                    else {
                                        str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><input  alt='" + data.Data.items[i].Id + "' onclick='finish(this)' type='button' value='点击确认完成审批'/><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr><tr></tr>";
                                    }
                                }
                                else {
                                    str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr><tr></tr>";
                                }
                            }
                            break;
                        case 2: str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>修改需求计划</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr><tr></tr>"; break;
                        case 3:
                            if (data.Data.items[i].sum != 0) {
                                str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr><tr></tr>";
                            }
                            else {
                                str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></td></tr><tr></tr>";
                            }
                            break;
                        case 4:
                            if (data.Data.items[i].lastId) {
                                if (data.Data.items[i].finish) {
                                    str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><span style='color:red'>审批流程已完成</span><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr><tr></tr>";
                                }
                                else {
                                    str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><input alt='" + data.Data.items[i].Id + "' onclick='finish(this)' type='button' value='点击确认完成审批'/><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr><tr></tr>";
                                }
                            }
                            else {
                                str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr><tr></tr>";
                            }
                            break;
                        case 5:
                            if (data.Data.items[i].count != 0) {
                                str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "</td><td style='text-align:center;'><img onmouseover='showNotice(this)' onmouseout='hideNotice(this)' src='/Images/notice.png' style='width:20px;vertical-align:middle;' /><div class='notice'>" + data.Data.items[i].reason + "</div><a href='###' class='progressBt'  onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='/单位用户后台/PlanDetail?id=" + data.Data.items[i].Id + "&&page=1' target='_blank'>查看审核详情</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr><tr></tr>";
                            }
                            else {
                                str += "<tr><td><span class='icon'></span><a title='" + data.Data.items[i].Id + "' onclick='showChild(this)' lang='0'>" + data.Data.items[i].title + "</a></td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "</td><td style='text-align:center;'><img onmouseover='showNotice(this)' onmouseout='hideNotice(this)' src='/Images/notice.png' style='width:20px;vertical-align:middle;' /><div class='notice'>" + data.Data.items[i].reason + "</div><a href='###' class='progressBt' onclick='history(this)'  alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###' onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a><a onclick='del_demand(" + data.Data.items[i].Id + ",this)' href='###'>删除</a></td></tr><tr></tr>";
                            }
                            break;
                        case 6:
                            if (data.Data.items[i].sum != 0) {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></tr>";
                            }
                            else {
                                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "<a href='###' class='progressBt' onclick='history(this)' alt='" + data.Data.items[i].Id + "'>(点击查看)</a></td><td><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>查看详情</a><a href='/单位用户后台/Demand_Detail?id=" + data.Data.items[i].Id + "' target='_blank'>修改需求计划</a><a onclick='showBox(\"#pdf1\",this)' href='###' lang='" + data.Data.items[i].Id + "'>提交</a><a href='###'  onclick='printInfo(" + data.Data.items[i].Id + ")'>导出EXCEL</a></td></td></tr>";
                            }
                            break;
                    }
                }
            }
            else {
                str += "<tr><td colspan='7' style='color:red;'>还没有任何需求信息</td></tr>";
            }
            str += "</table>";
            $("#tabItem1").html(str);
        });
    }
    $(document).ready(function () {
        getItems1(1, 2);
        getItems(1, 1);
    });
    function finish(th) {
        var str = $(th).attr("alt");
        $.get("/单位用户后台/updateDemand", { id: str }, function (data) {
            if (data == "1") {
                $(th).replaceWith("<span style='color:red;'>审批流程已完成</span>");
                alert("审核流程已完成");
            }
            else if (data == "-1") {
                $(th).replaceWith("<span style='color:red;'>审批流程已完成</span>");
                alert("审核流程已完成，请到编制采购任务处下达任务");
            }
            else
            {
                alert("操作失败！请重新操作。");
            }
        });
    }
    $("#adduser").click(function () {
        var str = $("#template").html();
        $("table.container").append("<tr><td align='right'>需求计划审核单位：</td><td>" + str + "</td></tr>");
    });
    var isShow = true;
    function debefore(th, str) {
        if (str == "") {
            $(th).parent("td").parent("tr").remove();
        }
        else {
            $(str).hide();
            isShow = false;
        }
    }
    $("#addTopuser").click(function () {//添加审核单位
        if (isShow) {
            alert("只能添加一个上级助理员！");
        }
        else {
            $("#usertop").show();
            if ($("#monitor").val() != "-1") {
                $("#topuser").val($("#monitor").val());
            }
            isShow = true;
        }
    });
    $("#monitor").change(function () {
        if ($(this).val() != "-1") {
            $("#topuser").val($(this).val());
        }
        else {
            $("#topuser").val("-1");
        }
    });
    function subform(str) {
        var userId = "";
        $("#pdf1 .user").each(function () {
            var have = false;
            if ($(this).val() != "-1") {
                if (userId != "") {
                    for (var i = 0; i < userId.split(',').length - 1; i++) {
                        if (userId.split(',')[i] == $(this).val()) {
                            have = true;
                            break;
                        }
                    }
                    if (!have) {
                        userId += $(this).val() + ",";
                    }
                }
                else
                {
                    if ($(this).val() != "-1") {
                        userId += $(this).val() + ",";
                    }
                }
            }
        });
        if(isShow)
        {
            $("#topuser").val($("#monitor").val());
        }
        $("#uid").val(userId);
        document.forms["checker"].submit();
    }
    function printInfo(id) {
        window.location = '/单位用户后台/ImportExcel?id=' + id;
        //setTimeout("printDisInfo(" + id + ")", 1000);
    }
    //function printDisInfo(id) {
    //    window.location = '/单位用户后台/PrintDExcel?id=' + id;
    //}
    $("div#tabHeader a").mouseover(function () {
        var id = $(this).attr("href");
        $("#tabHeader a").css("background-color", "red");
        $(this).css("background-color", "#0094ff");
        $("#container div").hide();
        $(id).show();
    });
    function history(th) {
        $("#pdf2").show();
        var d = $(th).attr("alt");
        $.get('/单位用户后台/History', { id: d }, function (data) {
            if (data.Data.length != 0) {
                var str = "<table class='status' width='90%' style='margin:20px auto;' cellpadding='0' cellspacing='0'><tr><th>审核单位</th><th>审核时间</th><th>审核结果</th></tr>";
                for (var i = 0; i < data.Data.length; i++) {
                    str += "<tr><td align='center'>" + data.Data[i].user + "</td><td align='center'>" + data.Data[i].time + "</td><td align='center'>" + data.Data[i].status + "</td></tr>";
                }
                str += "</table>";
                $("#progress1").html(str);
            }
            else {
                $("#progress1").html("<h3 style='color:red; text-align:center;'>暂时没有任何审核数据！</h3>");
            }
        });
    }
    function hidebox1(th) {
        $(th).hide();
    }
    function showItem(th, str) {
        $("a.tabHeader").each(function () {
            $(this).css({ "background-color": "#207AD6" });
        });
        $(th).css({ "background-color": "#D67C24" });
        $("#outbox").children("div").each(function () {
            $(this).hide();
        });
        $(str).show();
    }
    function showChild(th) {
        $.get('/单位用户后台/getChildren', { id: $(th).attr("title") }, function (data) {
            var str = "<td colspan='7'><div class='children'><table width='100%' cellpadding='0' cellspacing='0' style='border:none;border-left:#aaa solid 1px;'>";
            for (var i = 0; i < data.Data.items.length; i++) {
                str += "<tr><td>" + data.Data.items[i].title + "</td><td>" + data.Data.items[i].time + "</td><td>" + data.Data.items[i].contactMan + "</td><td>" + data.Data.items[i].phone + "</td><td>" + data.Data.items[i].status + "</td></tr>"
            }
            str += "</table></div></td>";
            $(th).parent("td").parent("tr").next("tr").html(str);
            var num = $(th).attr("lang");
            if (num == "0") {
                $(th).parent("td").parent("tr").next("tr").show();
                $(th).prev("span").css("background", "url(/Images/tree_icons.png) 0px -22px");
                $(th).attr("lang", "1");
            }
            else {
                $(th).parent("td").parent("tr").next("tr").hide();
                $(th).prev("span").css("background", "url(/Images/tree_icons.png) 0px -5px");
                $(th).attr("lang", "0");
            }
        });
    }
    function del_demand(number,th)
    {
        if(confirm("确定删除此需求计划吗？"))
        {
            $.get("/单位用户后台/deletePlan", { id: number }, function (data) {
                if(data==1)
                {
                    getItems(1, 1);
                }
                else
                {
                    alert("删除失败！请重新尝试删除。");
                }

            });
        }
    }
    $(function () {
        $("div.Page5").addClass("on");
        $("#我的需求计划列表").addClass("left_menu_select").children("a").css({ "color": "#fff" });
        $("#我的需求计划列表").parents().attr("show", "true").show().prev("li").addClass("open").children("span").css({ "background": "url('../Images/tree_icons.png') -115px -4px" });
    });
</script>